<!doctype html><html lang=en><head><title>Modelling Relationships in F# for Domain-Driven Design</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ffc4c7b40a84a6cc07476bf220dd79432177a593771276da69cb703d50fcac34.css integrity="sha256-/8THtAqEpswHR2vyIN15QyF3pZN3EnbaactwPVD8rDQ="><link rel=icon type=image/png href=/images/site/favicon_hu14458373468778497799.png><meta property="og:url" content="https://carlvinjerry.github.io/posts/programming/functional-programming/discriminated-unions/"><meta property="og:site_name" content="RΞCURSION"><meta property="og:title" content="Modelling Relationships in F# for Domain-Driven Design"><meta property="og:description" content="Learn how to use F#'s discriminated unions to model complex relationships in domain-driven design, with practical examples in financial data modeling."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-21T08:06:25+06:00"><meta property="article:modified_time" content="2025-08-18T17:45:06+03:00"><meta property="article:tag" content="Functional Programming"><meta property="article:tag" content="F#"><meta property="article:tag" content="Language Features"><meta property="article:tag" content="Discriminated Unions"><meta name=twitter:card content="summary"><meta name=twitter:title content="Modelling Relationships in F# for Domain-Driven Design"><meta name=twitter:description content="Learn how to use F#'s discriminated unions to model complex relationships in domain-driven design, with practical examples in financial data modeling."><meta name=description content="Learn how to use F#'s discriminated unions to model complex relationships in domain-driven design, with practical examples in financial data modeling."><script async src="https://www.googletagmanager.com/gtag/js?id=462784605"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","462784605")}</script><script src=https://cdn.counter.dev/script.js data-id=CarlvinJerry data-utcoffset=1></script><script data-goatcounter=https://carlvinjerry.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1754343916303502928.png id=logo alt=Logo>
RΞCURSION</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/#projects>Projects</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>Notes</a></li><li class=nav-item><a class=nav-link href=https://toha-guides.netlify.app/posts/>Docs</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu1754343916303502928.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu14458373468778497799.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/introduction/ title=Introduction>Introduction</a></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/programming/> Programming</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/code-sustainability/> Code Sustainability</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/code-sustainability/error-handling/> Error Handling</a><ul><li><a class=list-link href=/posts/programming/code-sustainability/error-handling/python-exceptions/ title="Exception Handling in Python">Exception Handling in Python</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/> Succint FSharp</a><ul><li><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/currying/ title="Currying and Partial Application">Currying and Partial Application</a></li><li><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/working-with-paket/ title="A Better Way to Manage Dependencies in F#">A Better Way to Manage Dependencies in F#</a></li><li><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/memoization/ title="Memoization in F#">Memoization in F#</a></li><li><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/pattern-matching/ title="Pattern Matching in F#">Pattern Matching in F#</a></li><li><a class=list-link href=/posts/programming/code-sustainability/succint-fsharp/fs-option-type/ title="Understanding the F# Option Type">Understanding the F# Option Type</a></li></ul></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/programming/functional-programming/> Functional Programming</a><ul class=active><li><a class="active list-link" href=/posts/programming/functional-programming/discriminated-unions/ title="Discriminated Unions in F#">Discriminated Unions in F#</a></li><li><a class=list-link href=/posts/programming/functional-programming/functional-programming/ title="Functional Programming Nuances">Functional Programming Nuances</a></li><li><a class=list-link href=/posts/programming/functional-programming/monads/ title="Functors and Monads in F#">Functors and Monads in F#</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/interoperability/> Interoperability</a><ul><li><a class=list-link href=/posts/programming/interoperability/rdotnet-interop/ title="R.NET Integration in .NET">R.NET Integration in .NET</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/languages/> Languages</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/programming/languages/fsharp/> fsharp</a><ul><li><a class=list-link href=/posts/programming/languages/fsharp/fsharp-9-review/ title=fsharp-9-review>fsharp-9-review</a></li></ul></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/quantitative-finance/> Quantitative-Finance</a><ul><li><a class=list-link href=/posts/quantitative-finance/intro-to-sdes/ title="Introduction to SDEs">Introduction to SDEs</a></li><li><a class=list-link href=/posts/quantitative-finance/portfolio-risk-attribution/ title="Portfolio Risk Attribution">Portfolio Risk Attribution</a></li><li><a class=list-link href=/posts/quantitative-finance/moving-averages/ title="Simple Moving Average">Simple Moving Average</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/programming/functional-programming/discriminated-unions/discUnions.jpg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/j5_hu8605642293593435631.jpg alt="Author Image"><h5 class=author-name>Carlvin Jerry Mwange</h5><p class=text-muted>Monday, July 21, 2025 | 11 minutes</p></div><div class=title><h1>Modelling Relationships in F# for Domain-Driven Design</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/tags/functional-programming/ class="btn btn-sm btn-info">functional programming</a></li><li class=rounded><a href=/tags/f#/ class="btn btn-sm btn-info">F#</a></li><li class=rounded><a href=/tags/language-features/ class="btn btn-sm btn-info">language features</a></li><li class=rounded><a href=/tags/discriminated-unions/ class="btn btn-sm btn-info">Discriminated Unions</a></li></ul></div><div class=post-content id=post-content><p>As a functional-first programming language, F# excels at creating robust, maintainable, and expressive domain models. This is handy, particularly for complex domains like financial data or financial systems. In <em>Get Programming with F#: A Guide for .NET Developers</em> by Isaac Abraham, Lesson 21- &ldquo;Modeling Relationships in F#,&rdquo; introduces the use of <strong>discriminated unions</strong> (DUs) as a flexible and type-safe tool for modeling relationships between data entities. This blog post explores the concepts from this lesson, focusing on how to apply discriminated unions to domain specific development. Our focus is on cases in financial data domains, such as modeling financial instruments, transactions, or account types with detailed examples inspired by the book’s approach. We’ll dive into practical scenarios, demonstrating how F#’s type system and DUs can encode business rules, ensure correctness, and simplify domain driven modeling.</p><h2 id=why-discriminated-unions->Why Discriminated Unions ?</h2><p>Maintaining strict relationships in Domain-driven development often involves complex considerations. Building financial systems will include modeling for entities like accounts, transactions, or investment instruments that have specific rules and constraints. For example, a financial transaction might be a deposit, withdrawal, or transfer, each with distinct properties and validation rules. In object-oriented programming (e.g., C#), such relationships are typically modeled using <em>inheritance</em> (<strong>is-a</strong>) or composition (<strong>has-a</strong>). However, these approaches can lead to rigid hierarchies or verbose codebases that are hard to maintain.</p><p>F#’s discriminated unions offer a more elegant solution by allowing you to define <em>a type that can be one of several distinct cases, each with its own data structure</em>. This is particularly useful in domains where entities have mutually exclusive states or types (e.g., a financial instrument can be a stock, bond, or option, but not multiple at once). Inherently, DUs are:</p><ul><li><strong>Type-safe</strong>: The compiler ensures that all possible cases are handled, reducing runtime errors.</li><li><strong>Expressive</strong>: They allow you to encode business rules directly in the type system, making invalid states unrepresentable.</li><li><strong>Concise</strong>: They reduce boilerplate code compared to class hierarchies.</li><li><strong>Immutable by default</strong>: This aligns with functional programming principles, ensuring data consistency in applications where immutability is critical for auditability.</li></ul><p>In <em>Get Programming with F#</em>, Isaac Abraham emphasizes that DUs are a cornerstone of F#’s ability to model relationships effectively. Let’s explore this with financial data examples, drawing on the principles from Lesson 21.</p><hr><h2 id=example-1-modeling-financial-instruments>Example 1: Modeling Financial Instruments</h2><p>Financial instruments are a core concept in finance, representing assets like stocks, bonds, or derivatives. Each type of instrument has unique properties, but they all share a common context (e.g., they can be traded or valued). Let’s model financial instruments using a discriminated union in F#.</p><h3 id=defining-the-discriminated-union>Defining the Discriminated Union</h3><p>Suppose we want to model three types of financial instruments: <strong>Stock</strong>, <strong>Bond</strong>, and <strong>Option</strong>. Each has different attributes:</p><ul><li>A <strong>Stock</strong> has a ticker symbol and a current share price.</li><li>A <strong>Bond</strong> has a face value, coupon rate, and maturity date.</li><li>An <strong>Option</strong> has an underlying asset, strike price, and expiration date.</li></ul><p>Here’s how we can define this in F# using a discriminated union:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FinancialInstrument</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Stock <span style=color:#66d9ef>of</span> Ticker<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>*</span> SharePrice<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Bond <span style=color:#66d9ef>of</span> FaceValue<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>*</span> CouponRate<span style=color:#f92672>:</span> <span style=color:#66d9ef>float</span> <span style=color:#f92672>*</span> MaturityDate<span style=color:#f92672>:</span> System.DateTime
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Option <span style=color:#66d9ef>of</span> Underlying<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>*</span> StrikePrice<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>*</span> ExpirationDate<span style=color:#f92672>:</span> System.DateTime
</span></span></code></pre></div><p>Each case of the <code>FinancialInstrument</code> DU represents a specific type of instrument, with its associated data. The <code>Ticker</code>, <code>SharePrice</code>, <code>FaceValue</code>, etc., are named fields, making the code self-documenting and easy to understand.</p><h3 id=using-the-discriminated-union>Using the Discriminated Union</h3><p>With our DU well defined above, we can create some instances of financial instruments and write a function to describe them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>let</span> safaricomStock <span style=color:#f92672>=</span> Stock<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;SAF&#34;</span><span style=color:#f92672>,</span> 150<span style=color:#f92672>.</span>25m<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> treasuryBond <span style=color:#f92672>=</span> Bond<span style=color:#f92672>(</span>1000<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> 0<span style=color:#f92672>.</span>03<span style=color:#f92672>,</span> System.DateTime<span style=color:#f92672>(</span>2030<span style=color:#f92672>,</span> 12<span style=color:#f92672>,</span> 1<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> callOption <span style=color:#f92672>=</span> Option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;SAF&#34;</span><span style=color:#f92672>,</span> 160<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> System.DateTime<span style=color:#f92672>(</span>2025<span style=color:#f92672>,</span> 12<span style=color:#f92672>,</span> 31<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> describeInstrument instrument <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> instrument <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Stock<span style=color:#f92672>(</span>ticker<span style=color:#f92672>,</span> price<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> sprintf <span style=color:#e6db74>&#34;Stock: %s, Share Price: Ksh%.2f&#34;</span> ticker price
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Bond<span style=color:#f92672>(</span>faceValue<span style=color:#f92672>,</span> couponRate<span style=color:#f92672>,</span> maturity<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> 
</span></span><span style=display:flex><span>        sprintf <span style=color:#e6db74>&#34;Bond: Face Value Ksh%.2f, Coupon Rate %.2f%%, Matures %s&#34;</span> 
</span></span><span style=display:flex><span>            faceValue <span style=color:#f92672>(</span>couponRate <span style=color:#f92672>*</span> 100<span style=color:#f92672>.</span>0<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>maturity<span style=color:#f92672>.</span>ToString<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;yyyy-MM-dd&#34;</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Option<span style=color:#f92672>(</span>underlying<span style=color:#f92672>,</span> strike<span style=color:#f92672>,</span> expiration<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> 
</span></span><span style=display:flex><span>        sprintf <span style=color:#e6db74>&#34;Option: Underlying %s, Strike Price Ksh%.2f, Expires %s&#34;</span> 
</span></span><span style=display:flex><span>            underlying strike <span style=color:#f92672>(</span>expiration<span style=color:#f92672>.</span>ToString<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;yyyy-MM-dd&#34;</span><span style=color:#f92672>))</span>
</span></span></code></pre></div><p>Using pattern matching, we can handle each case explicitly. The <code>match</code> expression ensures that we account for all possible cases, and the F# compiler will warn us if we miss one. Let’s test it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span>printfn <span style=color:#e6db74>&#34;%s&#34;</span> <span style=color:#f92672>(</span>describeInstrument safaricomStock<span style=color:#f92672>)</span> <span style=color:#75715e>// Output: Stock: SAF, Share Price: Ksh150.25
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>printfn <span style=color:#e6db74>&#34;%s&#34;</span> <span style=color:#f92672>(</span>describeInstrument treasuryBond<span style=color:#f92672>)</span> <span style=color:#75715e>// Output: Bond: Face Value Ksh1000.00, Coupon Rate 3.00%, Matures 2030-12-01
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>printfn <span style=color:#e6db74>&#34;%s&#34;</span> <span style=color:#f92672>(</span>describeInstrument callOption<span style=color:#f92672>)</span> <span style=color:#75715e>// Output: Option: Underlying SAF, Strike Price Ksh160.00, Expires 2025-12-31
</span></span></span></code></pre></div><p>In a financial application, ensuring that all instrument types are handled correctly is critical. For example, a pricing function might need different logic for stocks (market price), bonds (discounted cash flow), and options (Black-Scholes model). The DU ensures that you can’t accidentally treat a bond as a stock, and the compiler enforces exhaustive pattern matching, reducing bugs. This aligns with Abraham’s emphasis on “trusting the compiler” to catch errors at compile time.</p><hr><h2 id=example-2-modeling-financial-transactions>Example 2: Modeling Financial Transactions</h2><p>Financial transactions are another area where relationships need careful modeling. A transaction could be a <strong>Deposit</strong>, <strong>Withdrawal</strong>, or <strong>Transfer</strong>, each with specific rules. For instance:</p><ul><li>A <strong>Deposit</strong> increases an account balance and requires a positive amount.</li><li>A <strong>Withdrawal</strong> decreases the balance but must not result in a negative balance.</li><li>A <strong>Transfer</strong> moves money between accounts, requiring both a source and destination account.</li></ul><h3 id=defining-the-transaction-type>Defining the Transaction Type</h3><p>We can model transactions using a discriminated union to encode the properties and constraints for each case:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AccountId</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Transaction</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Deposit <span style=color:#66d9ef>of</span> Amount<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>*</span> Account<span style=color:#f92672>:</span> AccountId
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Withdrawal <span style=color:#66d9ef>of</span> Amount<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>*</span> Account<span style=color:#f92672>:</span> AccountId
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Transfer <span style=color:#66d9ef>of</span> Amount<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>*</span> FromAccount<span style=color:#f92672>:</span> AccountId <span style=color:#f92672>*</span> ToAccount<span style=color:#f92672>:</span> AccountId
</span></span></code></pre></div><h3 id=enforcing-business-rules>Enforcing Business Rules</h3><p>To ensure valid transactions, we can now write a function that processes transactions and enforces our business rules, such as ensuring positive amounts and sufficient funds for withdrawals. Here’s an example implementation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Account</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> Id<span style=color:#f92672>:</span> AccountId<span style=color:#f92672>;</span> Balance<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> processTransaction accounts transaction <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> transaction <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Deposit<span style=color:#f92672>(</span>amount<span style=color:#f92672>,</span> accountId<span style=color:#f92672>)</span> <span style=color:#66d9ef>when</span> amount <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>.</span>0m <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> account <span style=color:#f92672>=</span> accounts <span style=color:#f92672>|&gt;</span> List.find <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> accountId<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> updatedAccount <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> account <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>+</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        Ok <span style=color:#f92672>(</span>accounts <span style=color:#f92672>|&gt;</span> List.map <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>if</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> accountId <span style=color:#66d9ef>then</span> updatedAccount <span style=color:#66d9ef>else</span> a<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Deposit<span style=color:#f92672>(_,</span> <span style=color:#f92672>_)</span> <span style=color:#f92672>-&gt;</span> Error <span style=color:#e6db74>&#34;Deposit amount must be positive&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Withdrawal<span style=color:#f92672>(</span>amount<span style=color:#f92672>,</span> accountId<span style=color:#f92672>)</span> <span style=color:#66d9ef>when</span> amount <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>.</span>0m <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> account <span style=color:#f92672>=</span> accounts <span style=color:#f92672>|&gt;</span> List.find <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> accountId<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>&gt;=</span> amount <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> updatedAccount <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> account <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            Ok <span style=color:#f92672>(</span>accounts <span style=color:#f92672>|&gt;</span> List.map <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>if</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> accountId <span style=color:#66d9ef>then</span> updatedAccount <span style=color:#66d9ef>else</span> a<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            Error <span style=color:#e6db74>&#34;Insufficient funds&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Withdrawal<span style=color:#f92672>(_,</span> <span style=color:#f92672>_)</span> <span style=color:#f92672>-&gt;</span> Error <span style=color:#e6db74>&#34;Withdrawal amount must be positive&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Transfer<span style=color:#f92672>(</span>amount<span style=color:#f92672>,</span> fromAccountId<span style=color:#f92672>,</span> toAccountId<span style=color:#f92672>)</span> <span style=color:#66d9ef>when</span> amount <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>.</span>0m <span style=color:#f92672>&amp;&amp;</span> fromAccountId <span style=color:#f92672>&lt;&gt;</span> toAccountId <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> fromAccount <span style=color:#f92672>=</span> accounts <span style=color:#f92672>|&gt;</span> List.find <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> fromAccountId<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> toAccount <span style=color:#f92672>=</span> accounts <span style=color:#f92672>|&gt;</span> List.find <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> toAccountId<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> fromAccount<span style=color:#f92672>.</span>Balance <span style=color:#f92672>&gt;=</span> amount <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> updatedFrom <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> fromAccount <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> fromAccount<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> updatedTo <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> toAccount <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> toAccount<span style=color:#f92672>.</span>Balance <span style=color:#f92672>+</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            Ok <span style=color:#f92672>(</span>accounts <span style=color:#f92672>|&gt;</span> List.map <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> a <span style=color:#f92672>-&gt;</span> 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> fromAccountId <span style=color:#66d9ef>then</span> updatedFrom 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> a<span style=color:#f92672>.</span>Id <span style=color:#f92672>=</span> toAccountId <span style=color:#66d9ef>then</span> updatedTo 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> a<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            Error <span style=color:#e6db74>&#34;Insufficient funds in source account&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Transfer<span style=color:#f92672>(_,</span> <span style=color:#f92672>_,</span> <span style=color:#f92672>_)</span> <span style=color:#f92672>-&gt;</span> Error <span style=color:#e6db74>&#34;Invalid transfer: amount must be positive and accounts must be different&#34;</span>
</span></span></code></pre></div><p>This function uses pattern matching with guards (<code>when</code> clauses) to enforce rules like positive amounts and sufficient funds. The <code>Result</code> type (<code>Ok</code> or <code>Error</code>) is used to handle success or failure, a common functional programming pattern for error handling.</p><h3 id=testing-the-transaction-processor>Testing the Transaction Processor</h3><p>Let’s test it with a sample account list:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>let</span> accounts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span> Id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A1&#34;</span><span style=color:#f92672>;</span> Balance <span style=color:#f92672>=</span> 1000<span style=color:#f92672>.</span>0m <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span> Id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A2&#34;</span><span style=color:#f92672>;</span> Balance <span style=color:#f92672>=</span> 500<span style=color:#f92672>.</span>0m <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> deposit <span style=color:#f92672>=</span> Deposit<span style=color:#f92672>(</span>200<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;A1&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> withdrawal <span style=color:#f92672>=</span> Withdrawal<span style=color:#f92672>(</span>300<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;A2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> transfer <span style=color:#f92672>=</span> Transfer<span style=color:#f92672>(</span>100<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;A1&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;A2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> invalidWithdrawal <span style=color:#f92672>=</span> Withdrawal<span style=color:#f92672>(</span>1000<span style=color:#f92672>.</span>0m<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;A2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> testTransaction transaction <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> processTransaction accounts transaction <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Ok updatedAccounts <span style=color:#f92672>-&gt;</span> 
</span></span><span style=display:flex><span>        printfn <span style=color:#e6db74>&#34;Success! Updated accounts: %A&#34;</span> updatedAccounts
</span></span><span style=display:flex><span>        updatedAccounts
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Error msg <span style=color:#f92672>-&gt;</span> 
</span></span><span style=display:flex><span>        printfn <span style=color:#e6db74>&#34;Error: %s&#34;</span> msg
</span></span><span style=display:flex><span>        accounts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> accountsAfterDeposit <span style=color:#f92672>=</span> testTransaction deposit
</span></span><span style=display:flex><span><span style=color:#75715e>// Output: Success! Updated accounts: [{ Id = &#34;A1&#34;; Balance = 1200.0 }; { Id = &#34;A2&#34;; Balance = 500.0 }]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> accountsAfterWithdrawal <span style=color:#f92672>=</span> testTransaction withdrawal
</span></span><span style=display:flex><span><span style=color:#75715e>// Output: Success! Updated accounts: [{ Id = &#34;A1&#34;; Balance = 1200.0 }; { Id = &#34;A2&#34;; Balance = 200.0 }]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> accountsAfterTransfer <span style=color:#f92672>=</span> testTransaction transfer
</span></span><span style=display:flex><span><span style=color:#75715e>// Output: Success! Updated accounts: [{ Id = &#34;A1&#34;; Balance = 1100.0 }; { Id = &#34;A2&#34;; Balance = 300.0 }]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> accountsAfterInvalid <span style=color:#f92672>=</span> testTransaction invalidWithdrawal
</span></span><span style=display:flex><span><span style=color:#75715e>// Output: Error: Insufficient funds
</span></span></span></code></pre></div><p>Defining these business rules is important because domain-driven platforms like financial systems require strict validation to prevent errors like overdrafts or invalid transfers. The DU approach ensures that all transaction types are explicitly defined and handled, and the compiler enforces that no case is missed. By encoding business rules (e.g., positive amounts, sufficient funds) in the type system and pattern matching, we reduce the risk of runtime errors and make the code more maintainable. This is a key strength of F# as it allows developers to encode domain logic directly in the type system, making illegal states unrepresentable.</p><hr><h2 id=example-3-modeling-account-types-with-business-rules>Example 3: Modeling Account Types with Business Rules</h2><p>In a banking system, accounts can have different types (e.g., <strong>Checking</strong>, <strong>Savings</strong>, or <strong>Investment</strong>), each with specific rules. For example:</p><ul><li>A <strong>Checking</strong> account allows overdrafts up to a limit.</li><li>A <strong>Savings</strong> account has a minimum balance requirement.</li><li>An <strong>Investment</strong> account tracks a portfolio of instruments.</li></ul><h3 id=defining-the-account-type>Defining the Account Type</h3><p>We can use a discriminated union to model account types and embed their specific properties:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AccountType</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Checking <span style=color:#66d9ef>of</span> OverdraftLimit<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Savings <span style=color:#66d9ef>of</span> MinimumBalance<span style=color:#f92672>:</span> <span style=color:#66d9ef>decimal</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Investment <span style=color:#66d9ef>of</span> Portfolio<span style=color:#f92672>:</span> FinancialInstrument <span style=color:#66d9ef>list</span>
</span></span></code></pre></div><h3 id=processing-withdrawals-by-account-type>Processing Withdrawals by Account Type</h3><p>Let’s write a function respecting the rules for each account type to process withdrawals:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>let</span> processWithdrawal amount accountType account <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> accountType <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Checking<span style=color:#f92672>(</span>overdraftLimit<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>&gt;=</span> <span style=color:#f92672>-</span>overdraftLimit <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            Ok <span style=color:#f92672>{</span> account <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            Error <span style=color:#e6db74>&#34;Amount exceeds overdraft limit&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Savings<span style=color:#f92672>(</span>minimumBalance<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>&gt;=</span> minimumBalance <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            Ok <span style=color:#f92672>{</span> account <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            Error <span style=color:#e6db74>&#34;Amount below minimum balance&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Investment<span style=color:#f92672>(_)</span> <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>&gt;=</span> amount <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            Ok <span style=color:#f92672>{</span> account <span style=color:#66d9ef>with</span> Balance <span style=color:#f92672>=</span> account<span style=color:#f92672>.</span>Balance <span style=color:#f92672>-</span> amount <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            Error <span style=color:#e6db74>&#34;Insufficient funds&#34;</span>
</span></span></code></pre></div><h3 id=testing-the-withdrawal-function>Testing the Withdrawal Function</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=display:flex><span><span style=color:#66d9ef>let</span> checkingAccount <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> Id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A1&#34;</span><span style=color:#f92672>;</span> Balance <span style=color:#f92672>=</span> 100<span style=color:#f92672>.</span>0m <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> savingsAccount <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> Id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A2&#34;</span><span style=color:#f92672>;</span> Balance <span style=color:#f92672>=</span> 1000<span style=color:#f92672>.</span>0m <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> investmentAccount <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> Id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A3&#34;</span><span style=color:#f92672>;</span> Balance <span style=color:#f92672>=</span> 500<span style=color:#f92672>.</span>0m <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> checkingType <span style=color:#f92672>=</span> Checking<span style=color:#f92672>(</span>50<span style=color:#f92672>.</span>0m<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> savingsType <span style=color:#f92672>=</span> Savings<span style=color:#f92672>(</span>200<span style=color:#f92672>.</span>0m<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> investmentType <span style=color:#f92672>=</span> Investment<span style=color:#f92672>([</span>safaricomStock<span style=color:#f92672>;</span> treasuryBond<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> testWithdrawal amount account accountType <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> processWithdrawal amount accountType account <span style=color:#66d9ef>with</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Ok updatedAccount <span style=color:#f92672>-&gt;</span> printfn <span style=color:#e6db74>&#34;Withdrawal successful: %A&#34;</span> updatedAccount
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> Error msg <span style=color:#f92672>-&gt;</span> printfn <span style=color:#e6db74>&#34;Withdrawal failed: %s&#34;</span> msg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>testWithdrawal 120<span style=color:#f92672>.</span>0m checkingAccount checkingType <span style=color:#75715e>// Output: Withdrawal successful: { Id = &#34;A1&#34;; Balance = -20.0 }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>testWithdrawal 900<span style=color:#f92672>.</span>0m savingsAccount savingsType <span style=color:#75715e>// Output: Withdrawal successful: { Id = &#34;A2&#34;; Balance = 100.0 }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>testWithdrawal 600<span style=color:#f92672>.</span>0m investmentAccount investmentType <span style=color:#75715e>// Output: Withdrawal failed: Insufficient funds
</span></span></span></code></pre></div><p>This example demonstrates how DUs can encode domain-specific rules (e.g., overdraft limits, minimum balances) directly in the type system. Associating data like <code>OverdraftLimit</code> or <code>MinimumBalance</code> with the account type ensures that the rules are enforced at compile time, reducing the risk of errors in financial calculations. Abraham’s lesson emphasizes that DUs allow developers to model complex relationships in a way that is both expressive and safe, aligning perfectly with the needs of specific domains.</p><hr><h2 id=key-takeaways>Key Takeaways</h2><p>Isaac Abraham’s <em>Get Programming with F#</em> highlights several key benefits of using discriminated unions for modeling relationships, particularly in domains like finance:</p><ol><li><strong>Type Safety</strong>: DUs ensure that all possible cases are handled via pattern matching, preventing runtime errors. For example, you can’t process a transaction without accounting for deposits, withdrawals, and transfers.</li><li><strong>Expressive Domain Modeling</strong>: DUs allow you to represent complex relationships (e.g., different types of financial instruments or accounts) in a concise and readable way.</li><li><strong>Business Rules in Code</strong>: By embedding rules like positive amounts or sufficient funds in the type system, you make invalid states unrepresentable, a concept Abraham refers to as “making illegal states unrepresentable.”</li><li><strong>Maintainability</strong>: Adding a new transaction type (e.g., <code>DividendPayment</code>) requires updating the DU and pattern matching, and the compiler will guide you to update all relevant code paths.</li></ol><h2 id=conclusion>Conclusion</h2><p>Modeling relationships in F# using discriminated unions provides a powerful approach to building robust domain-specific applications. By leveraging DUs, you can create type-safe, expressive, and maintainable domain models that encode business rules directly in the code. The financial data examples above—modeling instruments, transactions, and account types—demonstrate how F#’s type system can simplify complex domains while ensuring correctness.</p><blockquote><p>As Isaac Abraham notes, F#’s functional-first approach, combined with tools like DUs, leads developers to a “pit of success,” where the language’s design naturally guides you toward writing better code.</p></blockquote><p>For further exploration, check out the companion code repository for <em>Get Programming with F#</em> on <a href=https://github.com/isaacabraham/get-programming-fsharp target=_blank>Github</a> or dive into Abraham’s <em>F# in Action</em> for more advanced domain-modelling examples. May your models be as robust as your F# types!</p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f&text=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design&via=R%ce%9eCURSION" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f&title=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f&title=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-mastodon" href="https://mastodon.social/share?text=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design - https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f" target=_blank><i class="fab fa-mastodon"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Modelling%20Relationships%20in%20F%23%20for%20Domain-Driven%20Design&body=https%3a%2f%2fcarlvinjerry.github.io%2fposts%2fprogramming%2ffunctional-programming%2fdiscriminated-unions%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/carlvinjerry/carlvinjerry.github.io/edit/main/content/posts/programming/Functional%20Programming/discriminated%20unions/index.markdown title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/programming/code-sustainability/succint-fsharp/fs-option-type/ title="Enhancing Code Maintainability with the F# 'Option' Type" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Enhancing Code Maintainability with the F# 'Option' Type</div></a></div><div class="col-md-6 next-article"><a href=/posts/programming/functional-programming/functional-programming/ title="Functional Programming" class="btn filled-button"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Functional Programming</div></a></div></div><hr><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="i_carlvin",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#why-discriminated-unions->Why Discriminated Unions ?</a></li><li><a href=#example-1-modeling-financial-instruments>Example 1: Modeling Financial Instruments</a><ul><li><a href=#defining-the-discriminated-union>Defining the Discriminated Union</a></li><li><a href=#using-the-discriminated-union>Using the Discriminated Union</a></li></ul></li><li><a href=#example-2-modeling-financial-transactions>Example 2: Modeling Financial Transactions</a><ul><li><a href=#defining-the-transaction-type>Defining the Transaction Type</a></li><li><a href=#enforcing-business-rules>Enforcing Business Rules</a></li><li><a href=#testing-the-transaction-processor>Testing the Transaction Processor</a></li></ul></li><li><a href=#example-3-modeling-account-types-with-business-rules>Example 3: Modeling Account Types with Business Rules</a><ul><li><a href=#defining-the-account-type>Defining the Account Type</a></li><li><a href=#processing-withdrawals-by-account-type>Processing Withdrawals by Account Type</a></li><li><a href=#testing-the-withdrawal-function>Testing the Withdrawal Function</a></li></ul></li><li><a href=#key-takeaways>Key Takeaways</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://carlvinjerry.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://carlvinjerry.github.io/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://carlvinjerry.github.io/#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:carlvinjerry@gmail.com%20%7c%20cmwange@beyondrawdata.co.ke target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>carlvinjerry@gmail.com | cmwange@beyondrawdata.co.ke</span></a></li><li><a href=https://github.com/carlvinjerry target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>carlvinjerry</span></a></li><li><a href=https://www.linkedin.com/in/carlvinmwange target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Carlvin Jerry Mwange</span></a></li><li><a href=tel:+254%20%280%29747%20942%20588 target=_blank rel=noopener><span><i class="fas fa-phone-alt"></i></span> <span>+254 (0)747 942 588</span></a></li><li><a href=https://www.researchgate.net/profile/carlvinmwange target=_blank rel=noopener><span><i class="fab fa-researchgate"></i></span> <span>Carlvin Jerry Mwange</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu16779671404603505019.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.b1192b27bb9da1367104dd2311a23a6f78cc8e16c840ce3f8406443569df5b65.js integrity="sha256-sRkrJ7udoTZxBN0jEaI6b3jMjhbIQM4/hAZENWnfW2U=" defer></script></body></html>